# Параметры банковского счета
N <- 200   # Количество периодов
r <- 0.01  # Процентная ставка
B <- numeric(N + 1)
B[1] <- 1  # Начальное значение

# Моделируем процесс для банковского счета
for (n in 2:(N + 1)) 
{
  B[n] <- B[n - 1] * (1 + r)
}

# График банковского счета
plot(0:N, B, type="l", main="Процесс банковского счета B_n", xlab="Время", ylab="B_n")
# Параметры акции
S <- numeric(N + 1)
S[1] <- 1  # Начальное значение
a <- -0.3
b <- 0.8
p <- 0.4

# Моделируем процесс для акции
for (n in 2:(N + 1)) 
{
  rho <- ifelse(runif(1) < p, b, a)
  S[n] <- S[n - 1] * (1 + rho)
}

# График процесса акции
plot(0:N, S, type="l", main="Процесс акции S_n", xlab="Время", ylab="S_n")
# Параметры для call-опциона
S0 <- 100
K <- 100
r <- 0.2
a <- -0.3
b <- 0.8
N <- 10

# Вероятность по формуле
p_star <- (1 + r - a) / (b - a)
q_star <- 1 - p_star

# Вычисление справедливой цены опциона
payoff <- numeric(N + 1)
for (k in 0:N) 
{
  ST <- S0 * (1 + b)^k * (1 + a)^(N - k)  # Конечная цена акции
  payoff[k + 1] <- max(0, ST - K)         # Выплата опциона
}

# Расчет стоимости опциона через дисконтированные вероятности
option_price <- 0
for (k in 0:N) 
{
  comb <- choose(N, k)  # Число сочетаний
  prob <- comb * p_star^k * q_star^(N - k)
  option_price <- option_price + payoff[k + 1] * prob
}
option_price <- option_price / ((1 + r)^N)

cat("Справедливая цена call-опциона:", option_price, "\n")
